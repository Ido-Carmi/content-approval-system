{% extends "base.html" %}
{% block title %}×ª×’×•×‘×•×ª ××•×¡×ª×¨×•×ª{% endblock %}
{% block page_title %}<div class="text-center">ğŸ—¨ï¸ ×ª×’×•×‘×•×ª ××•×¡×ª×¨×•×ª</div>{% endblock %}

{% block content %}
<style>
/* Comments page specific styles */
.comment-card {
    margin-bottom: 1.5rem;
}

.comment-item {
    border-right: 3px solid #6c757d;
    padding-right: 1rem;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e9ecef;
}

.comment-item:last-child {
    border-bottom: none;
}

.comment-item.political {
    border-right-color: #0d6efd;
}

.comment-item.hate {
    border-right-color: #dc3545;
}

.post-header {
    background: linear-gradient(135deg, #198754 0%, #20c997 100%);
    cursor: pointer;
    user-select: none;
}

.post-header:hover {
    opacity: 0.95;
}

.comment-text {
    background: #f8f9fa;
    padding: 0.75rem;
    border-radius: 6px;
    margin: 0.5rem 0;
    white-space: pre-wrap;
    word-wrap: break-word;
}

.ai-explanation {
    font-size: 0.9rem;
    color: #6c757d;
    font-style: italic;
}

.stat-card {
    text-align: center;
    padding: 1.5rem;
}

.stat-card h3 {
    font-size: 2rem;
    margin: 0;
    font-weight: bold;
}

.stat-card p {
    margin: 0;
    color: #6c757d;
}

.filter-reason {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.filter-reason.political {
    background: #cfe2ff;
    color: #084298;
}

.filter-reason.hate {
    background: #f8d7da;
    color: #842029;
}

.author-name {
    font-weight: 600;
    color: #495057;
}

.comment-time {
    font-size: 0.85rem;
    color: #6c757d;
}
</style>

<!-- Stats Row -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body stat-card">
                <h3 class="text-primary">{{ stats.total }}</h3>
                <p>×¡×”"×› ×ª×’×•×‘×•×ª ××•×¡×ª×¨×•×ª</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body stat-card">
                <h3 class="text-info">{{ stats.political }}</h3>
                <p>×ª×•×›×Ÿ ×¤×•×œ×™×˜×™</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body stat-card">
                <h3 class="text-danger">{{ stats.hate }}</h3>
                <p>×©× ××” ×•×§×œ×œ×•×ª</p>
            </div>
        </div>
    </div>
</div>

<!-- Filter Tabs -->
<div class="card mb-3">
    <div class="card-body">
        <div class="btn-group" role="group">
            <a href="{{ url_for('hidden_comments_page') }}" 
               class="btn {% if not filter_type or filter_type == 'all' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                ×”×›×œ ({{ stats.total }})
            </a>
            <a href="{{ url_for('hidden_comments_page', filter='political') }}" 
               class="btn {% if filter_type == 'political' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                ×¤×•×œ×™×˜×™ ({{ stats.political }})
            </a>
            <a href="{{ url_for('hidden_comments_page', filter='hate') }}" 
               class="btn {% if filter_type == 'hate' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                ×©× ××” ({{ stats.hate }})
            </a>
        </div>
        
        <button class="btn btn-secondary float-start" onclick="location.reload()">
            <i class="bi bi-arrow-clockwise"></i> ×¨×¢× ×Ÿ
        </button>
    </div>
</div>

<!-- No Comments -->
{% if not grouped_comments %}
<div class="alert alert-success text-center py-5">
    <h4><i class="bi bi-check-circle"></i> ××™×Ÿ ×ª×’×•×‘×•×ª ××•×¡×ª×¨×•×ª!</h4>
    <p class="mb-0">×›×œ ×”×ª×’×•×‘×•×ª ×¢×‘×¨×• ××ª ×”×¤×™×œ×˜×¨.</p>
</div>

<!-- Comments Grouped by Post -->
{% else %}
{% for post_id, post_data in grouped_comments.items() %}
<div class="card comment-card">
    <!-- Post Header (Collapsible) -->
    <div class="card-header post-header text-white" 
         data-bs-toggle="collapse" 
         data-bs-target="#post-{{ loop.index }}">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <strong>ğŸ“Œ ×¤×•×¡×˜ #{{ post_data.post_number or '?' }}</strong>
                <span class="badge bg-light text-dark me-2">{{ post_data.comments|length }} ×ª×’×•×‘×•×ª</span>
            </div>
            <i class="bi bi-chevron-down"></i>
        </div>
        <div class="mt-2" style="font-size: 0.9rem; opacity: 0.9;">
            {{ post_data.post_text[:150] }}{% if post_data.post_text|length > 150 %}...{% endif %}
        </div>
    </div>
    
    <!-- Comments List (Collapsible) -->
    <div id="post-{{ loop.index }}" class="collapse">
        <div class="card-body">
            {% for comment in post_data.comments %}
            <div class="comment-item {{ comment.filter_reason }}" id="comment-{{ comment.id }}">
                <!-- Author & Time -->
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                        <span class="author-name">ğŸ’¬ {{ comment.author_name }}</span>
                        <br>
                        <span class="comment-time">
                            <i class="bi bi-clock"></i> {{ comment.created_at }}
                        </span>
                    </div>
                    <span class="filter-reason {{ comment.filter_reason }}">
                        {% if comment.filter_reason == 'political' %}
                            ğŸ›ï¸ ×¤×•×œ×™×˜×™
                        {% elif comment.filter_reason == 'hate' %}
                            âš ï¸ ×©× ××”
                        {% endif %}
                    </span>
                </div>
                
                <!-- Comment Text -->
                <div class="comment-text">
                    {{ comment.comment_text }}
                </div>
                
                <!-- AI Explanation -->
                {% if comment.ai_explanation %}
                <div class="ai-explanation mt-2">
                    <i class="bi bi-robot"></i> <strong>×”×¡×‘×¨ AI:</strong> {{ comment.ai_explanation }}
                </div>
                {% endif %}
                
                <!-- Actions -->
                <div class="mt-3">
                    <button class="btn btn-sm btn-success" 
                            hx-post="{{ url_for('unhide_comment', comment_id=comment.comment_id) }}"
                            hx-target="#comment-{{ comment.id }}"
                            hx-swap="outerHTML swap:300ms"
                            hx-confirm="×‘×˜×•×— ×œ×‘×˜×œ ×”×¡×ª×¨×” ×©×œ ×ª×’×•×‘×” ×–×•?">
                        <i class="bi bi-eye"></i> ×‘×˜×œ ×”×¡×ª×¨×”
                    </button>
                    
                    <button class="btn btn-sm btn-danger" 
                            hx-post="{{ url_for('delete_comment', comment_id=comment.comment_id) }}"
                            hx-target="#comment-{{ comment.id }}"
                            hx-swap="outerHTML swap:300ms"
                            hx-confirm="×‘×˜×•×— ×œ××—×•×§ ×ª×’×•×‘×” ×–×• ×œ×¦××™×ª×•×ª? ×œ× × ×™×ª×Ÿ ×œ×©×—×–×¨!">
                        <i class="bi bi-trash"></i> ××—×§ ×œ×¦××™×ª×•×ª
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endfor %}
{% endif %}

<script>
// Auto-collapse all posts by default (show only headers)
document.addEventListener('DOMContentLoaded', function() {
    // Optionally expand first post
    // const firstPost = document.querySelector('[id^="post-"]');
    // if (firstPost) {
    //     new bootstrap.Collapse(firstPost, {show: true});
    // }
});
</script>

{% endblock %}
